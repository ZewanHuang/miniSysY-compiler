# Lab5 实验报告

> 学号：19373257 姓名：黄泽桓

## 简要介绍

本次实验让我认识到之前架构存在一定的问题，即符号表的建立和中间代码生成不能完全分开，在生成器工作的过程中，需要边维护符号表边生成，以实现符号寄存器的正确调用。

对于Part8，主要是在生成器中加入了符号表的维护，同时使用Stack栈结构体，维护当前的作用域ID：

- 当遇到`{`时，curBlockId加一，同时进栈
- 当遇到`}`时，将栈顶元素top弹出，同时设置符号表中属于top作用域的符号为不生效，并修改当前栈curBlockId为弹栈后的栈顶元素

这样遍历语法树时，遇到Ident时，从下往上遍历符号表去查表即可，获取当前作用域中有效符号。这样就实现了Part8的作用域与块问题了。

对于Part9，首先在递归下降器中添加规则，然后主要是全局变量值的计算。为计算具体值，我在符号表和语法树节点中都添加了intValue，遍历语法树时遇到具体计算则进行运算，并将结果记入节点；遇到Vn时将该值往上传递；遇到符号定义时将具体值写入符号表中。从而实现了intValue的计算。

## 参考

主要参考教材对编译过程的讲解，未参考其它具体的代码或教程。